-- TRAINING MULTIPLIER - REAL WORKING VERSION
-- Fokus multiply nilai yang DITERIMA dari training

local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- CONFIG
local Config = {
    Enabled = false,
    AutoTrain = false,
    Multiplier = 100000,  -- 100K default
    TrainDelay = 0.3
}

local Stats = {
    Trains = 0,
    TotalAdded = 0
}

-- REMOTES
local TrainSystem = ReplicatedStorage:WaitForChild("TrainSystem")
local TrainEquipment = ReplicatedStorage:WaitForChild("TrainEquipment")

-- GUI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "TrainMult"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = playerGui

local Frame = Instance.new("Frame")
Frame.Size = UDim2.new(0, 340, 0, 420)
Frame.Position = UDim2.new(0.5, -170, 0.5, -210)
Frame.BackgroundColor3 = Color3.fromRGB(15, 15, 20)
Frame.BorderSizePixel = 0
Frame.Active = true
Frame.Draggable = true
Frame.Parent = ScreenGui

local Corner = Instance.new("UICorner")
Corner.CornerRadius = UDim.new(0, 12)
Corner.Parent = Frame

local Stroke = Instance.new("UIStroke")
Stroke.Color = Color3.fromRGB(80, 150, 255)
Stroke.Thickness = 2
Stroke.Parent = Frame

-- Header
local Header = Instance.new("Frame")
Header.Size = UDim2.new(1, 0, 0, 45)
Header.BackgroundColor3 = Color3.fromRGB(20, 20, 30)
Header.BorderSizePixel = 0
Header.Parent = Frame

local HCorner = Instance.new("UICorner")
HCorner.CornerRadius = UDim.new(0, 12)
HCorner.Parent = Header

local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, -80, 1, 0)
Title.Position = UDim2.new(0, 15, 0, 0)
Title.BackgroundTransparency = 1
Title.Text = "⚡ TRAIN MULTIPLIER"
Title.TextColor3 = Color3.fromRGB(150, 200, 255)
Title.TextSize = 18
Title.Font = Enum.Font.GothamBold
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.Parent = Header

local MinBtn = Instance.new("TextButton")
MinBtn.Size = UDim2.new(0, 30, 0, 30)
MinBtn.Position = UDim2.new(1, -70, 0, 7)
MinBtn.BackgroundColor3 = Color3.fromRGB(255, 180, 0)
MinBtn.Text = "−"
MinBtn.TextSize = 20
MinBtn.Font = Enum.Font.GothamBold
MinBtn.BorderSizePixel = 0
MinBtn.Parent = Header

local MCorner = Instance.new("UICorner")
MCorner.CornerRadius = UDim.new(0, 8)
MCorner.Parent = MinBtn

local CloseBtn = Instance.new("TextButton")
CloseBtn.Size = UDim2.new(0, 30, 0, 30)
CloseBtn.Position = UDim2.new(1, -35, 0, 7)
CloseBtn.BackgroundColor3 = Color3.fromRGB(255, 80, 80)
CloseBtn.Text = "✕"
CloseBtn.TextSize = 18
CloseBtn.Font = Enum.Font.GothamBold
CloseBtn.BorderSizePixel = 0
CloseBtn.Parent = Header

local CCorner = Instance.new("UICorner")
CCorner.CornerRadius = UDim.new(0, 8)
CCorner.Parent = CloseBtn

-- Status Display
local StatusLbl = Instance.new("TextLabel")
StatusLbl.Size = UDim2.new(1, -30, 0, 30)
StatusLbl.Position = UDim2.new(0, 15, 0, 60)
StatusLbl.BackgroundTransparency = 1
StatusLbl.Text = "⚪ Status: OFF"
StatusLbl.TextColor3 = Color3.fromRGB(200, 200, 200)
StatusLbl.TextSize = 15
StatusLbl.Font = Enum.Font.GothamBold
StatusLbl.TextXAlignment = Enum.TextXAlignment.Left
StatusLbl.Parent = Frame

local TrainLbl = Instance.new("TextLabel")
TrainLbl.Size = UDim2.new(1, -30, 0, 25)
TrainLbl.Position = UDim2.new(0, 15, 0, 95)
TrainLbl.BackgroundTransparency = 1
TrainLbl.Text = "🎯 Trains: 0"
TrainLbl.TextColor3 = Color3.fromRGB(150, 255, 150)
TrainLbl.TextSize = 14
TrainLbl.Font = Enum.Font.Gotham
TrainLbl.TextXAlignment = Enum.TextXAlignment.Left
TrainLbl.Parent = Frame

local AddedLbl = Instance.new("TextLabel")
AddedLbl.Size = UDim2.new(1, -30, 0, 25)
AddedLbl.Position = UDim2.new(0, 15, 0, 125)
AddedLbl.BackgroundTransparency = 1
AddedLbl.Text = "💎 Total Added: 0"
AddedLbl.TextColor3 = Color3.fromRGB(255, 200, 100)
AddedLbl.TextSize = 14
AddedLbl.Font = Enum.Font.Gotham
AddedLbl.TextXAlignment = Enum.TextXAlignment.Left
AddedLbl.Parent = Frame

local InfoLbl = Instance.new("TextLabel")
InfoLbl.Size = UDim2.new(1, -30, 0, 40)
InfoLbl.Position = UDim2.new(0, 15, 0, 155)
InfoLbl.BackgroundTransparency = 1
InfoLbl.Text = "ℹ️ Hook akan multiply nilai\nyang diterima saat training"
InfoLbl.TextColor3 = Color3.fromRGB(150, 150, 200)
InfoLbl.TextSize = 12
InfoLbl.Font = Enum.Font.Gotham
InfoLbl.TextXAlignment = Enum.TextXAlignment.Left
InfoLbl.TextYAlignment = Enum.TextYAlignment.Top
InfoLbl.Parent = Frame

-- Multiplier Input
local MultTitle = Instance.new("TextLabel")
MultTitle.Size = UDim2.new(1, -30, 0, 25)
MultTitle.Position = UDim2.new(0, 15, 0, 205)
MultTitle.BackgroundTransparency = 1
MultTitle.Text = "🔥 Multiplier"
MultTitle.TextColor3 = Color3.fromRGB(255, 150, 100)
MultTitle.TextSize = 16
MultTitle.Font = Enum.Font.GothamBold
MultTitle.TextXAlignment = Enum.TextXAlignment.Left
MultTitle.Parent = Frame

local MultInput = Instance.new("TextBox")
MultInput.Size = UDim2.new(1, -30, 0, 45)
MultInput.Position = UDim2.new(0, 15, 0, 235)
MultInput.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
MultInput.BorderSizePixel = 0
MultInput.Text = tostring(Config.Multiplier)
MultInput.PlaceholderText = "Contoh: 100000"
MultInput.TextColor3 = Color3.fromRGB(255, 255, 0)
MultInput.TextSize = 20
MultInput.Font = Enum.Font.GothamBold
MultInput.Parent = Frame

local MICorner = Instance.new("UICorner")
MICorner.CornerRadius = UDim.new(0, 8)
MICorner.Parent = MultInput

-- Activate Button
local ActivateBtn = Instance.new("TextButton")
ActivateBtn.Size = UDim2.new(1, -30, 0, 50)
ActivateBtn.Position = UDim2.new(0, 15, 0, 295)
ActivateBtn.BackgroundColor3 = Color3.fromRGB(50, 150, 255)
ActivateBtn.Text = "🚀 ACTIVATE"
ActivateBtn.TextSize = 18
ActivateBtn.Font = Enum.Font.GothamBold
ActivateBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
ActivateBtn.BorderSizePixel = 0
ActivateBtn.Parent = Frame

local ABCorner = Instance.new("UICorner")
ABCorner.CornerRadius = UDim.new(0, 10)
ABCorner.Parent = ActivateBtn

-- Auto Train Button
local AutoBtn = Instance.new("TextButton")
AutoBtn.Size = UDim2.new(1, -30, 0, 50)
AutoBtn.Position = UDim2.new(0, 15, 0, 355)
AutoBtn.BackgroundColor3 = Color3.fromRGB(60, 60, 80)
AutoBtn.Text = "🤖 AUTO TRAIN: OFF"
AutoBtn.TextSize = 16
AutoBtn.Font = Enum.Font.GothamBold
AutoBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
AutoBtn.BorderSizePixel = 0
AutoBtn.Parent = Frame

local ATCorner = Instance.new("UICorner")
ATCorner.CornerRadius = UDim.new(0, 10)
ATCorner.Parent = AutoBtn

-- Minimized Frame
local MinFrame = Instance.new("Frame")
MinFrame.Size = UDim2.new(0, 250, 0, 45)
MinFrame.Position = UDim2.new(0.5, -125, 0, 20)
MinFrame.BackgroundColor3 = Color3.fromRGB(15, 15, 20)
MinFrame.BorderSizePixel = 0
MinFrame.Visible = false
MinFrame.Active = true
MinFrame.Draggable = true
MinFrame.Parent = ScreenGui

local MFCorner = Instance.new("UICorner")
MFCorner.CornerRadius = UDim.new(0, 10)
MFCorner.Parent = MinFrame

local MFStroke = Instance.new("UIStroke")
MFStroke.Color = Color3.fromRGB(80, 150, 255)
MFStroke.Thickness = 2
MFStroke.Parent = MinFrame

local MinLabel = Instance.new("TextLabel")
MinLabel.Size = UDim2.new(1, -100, 1, 0)
MinLabel.Position = UDim2.new(0, 15, 0, 0)
MinLabel.BackgroundTransparency = 1
MinLabel.Text = "⚡ Training"
MinLabel.TextColor3 = Color3.fromRGB(150, 200, 255)
MinLabel.TextSize = 16
MinLabel.Font = Enum.Font.GothamBold
MinLabel.TextXAlignment = Enum.TextXAlignment.Left
MinLabel.Parent = MinFrame

local MinStatus = Instance.new("TextLabel")
MinStatus.Size = UDim2.new(0, 60, 1, 0)
MinStatus.Position = UDim2.new(1, -110, 0, 0)
MinStatus.BackgroundTransparency = 1
MinStatus.Text = "⚪ OFF"
MinStatus.TextColor3 = Color3.fromRGB(200, 200, 200)
MinStatus.TextSize = 14
MinStatus.Font = Enum.Font.GothamBold
MinStatus.Parent = MinFrame

local RestoreBtn = Instance.new("TextButton")
RestoreBtn.Size = UDim2.new(0, 40, 0, 40)
RestoreBtn.Position = UDim2.new(1, -43, 0, 2)
RestoreBtn.BackgroundColor3 = Color3.fromRGB(80, 150, 255)
RestoreBtn.Text = "□"
RestoreBtn.TextSize = 20
RestoreBtn.Font = Enum.Font.GothamBold
RestoreBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
RestoreBtn.BorderSizePixel = 0
RestoreBtn.Parent = MinFrame

local RCorner = Instance.new("UICorner")
RCorner.CornerRadius = UDim.new(0, 8)
RCorner.Parent = RestoreBtn

-- FUNCTIONS
local function Fmt(n)
    if n >= 1e18 then return string.format("%.2fQu", n / 1e18)
    elseif n >= 1e15 then return string.format("%.2fQd", n / 1e15)
    elseif n >= 1e12 then return string.format("%.2fT", n / 1e12)
    elseif n >= 1e9 then return string.format("%.2fB", n / 1e9)
    elseif n >= 1e6 then return string.format("%.2fM", n / 1e6)
    elseif n >= 1e3 then return string.format("%.2fK", n / 1e3)
    else return tostring(math.floor(n)) end
end

local function UpdateDisplay()
    TrainLbl.Text = "🎯 Trains: " .. Fmt(Stats.Trains)
    AddedLbl.Text = "💎 Total Added: " .. Fmt(Stats.TotalAdded)
end

-- HOOK BINDABLE EVENT - INI YANG PENTING!
-- Hook PlayerTrainValueHasChanged untuk multiply nilai yang diterima
local trainBindable = TrainSystem.Bindable:WaitForChild("PlayerTrainValueHasChanged")

local oldFire = trainBindable.Fire
trainBindable.Fire = function(self, plr, trainType, newValue, oldValue)
    if Config.Enabled and plr == player then
        -- Hitung gain asli
        local originalGain = newValue - oldValue
        
        -- Multiply gain
        local multipliedGain = originalGain * Config.Multiplier
        
        -- Buat nilai baru yang sudah di-multiply
        local finalNewValue = oldValue + multipliedGain
        
        Stats.TotalAdded = Stats.TotalAdded + multipliedGain
        
        print(string.format("🔥 Train Type %d: +%s (Original: +%s, Mult: x%s)", 
            trainType, Fmt(multipliedGain), Fmt(originalGain), Fmt(Config.Multiplier)))
        
        -- Fire dengan nilai yang sudah di-multiply
        return oldFire(self, plr, trainType, finalNewValue, oldValue)
    end
    
    return oldFire(self, plr, trainType, newValue, oldValue)
end

-- Hook CombatPowerHasChanged juga
local cpBindable = TrainSystem.Bindable:WaitForChild("PlayerCombatPowerHasChanged")

local oldCPFire = cpBindable.Fire
cpBindable.Fire = function(self, plr, combatPower)
    if Config.Enabled and plr == player then
        -- Multiply combat power juga
        local multipliedCP = combatPower * Config.Multiplier
        
        print(string.format("💎 Combat Power: %s → %s", Fmt(combatPower), Fmt(multipliedCP)))
        
        return oldCPFire(self, plr, multipliedCP)
    end
    
    return oldCPFire(self, plr, combatPower)
end

-- Hook __namecall untuk multiply returns dari server
local oldNamecall
oldNamecall = hookmetamethod(game, "__namecall", function(self, ...)
    local method = getnamecallmethod()
    local args = {...}
    
    if not Config.Enabled then
        return oldNamecall(self, ...)
    end
    
    -- Hook InvokeServer
    if method == "InvokeServer" then
        local results = {pcall(oldNamecall, self, ...)}
        local success = table.remove(results, 1)
        
        if success and Config.Enabled then
            -- Multiply semua number returns
            for i = 1, #results do
                if type(results[i]) == "number" and results[i] > 0 and results[i] < 1e15 then
                    local original = results[i]
                    results[i] = results[i] * Config.Multiplier
                    
                    if results[i] > original then
                        Stats.TotalAdded = Stats.TotalAdded + (results[i] - original)
                    end
                end
            end
        end
        
        if success then
            return unpack(results)
        end
    end
    
    return oldNamecall(self, ...)
end)

-- AUTO TRAIN
task.spawn(function()
    while task.wait(Config.TrainDelay) do
        if Config.Enabled and Config.AutoTrain then
            pcall(function()
                local trainEquipRemote = TrainEquipment.Remote
                
                -- Apply Stationary Train
                local stationaryRemote = trainEquipRemote:FindFirstChild("ApplyStationaryTrain")
                if stationaryRemote then
                    stationaryRemote:InvokeServer()
                end
                
                task.wait(0.05)
                
                -- Apply Mobile Train
                local mobileRemote = trainEquipRemote:FindFirstChild("ApplyMobileTrain")
                if mobileRemote then
                    mobileRemote:InvokeServer()
                end
                
                task.wait(0.05)
                
                -- Apply Binding Training Effect
                local bindingRemote = trainEquipRemote:FindFirstChild("ApplyBindingTrainingEffect")
                if bindingRemote then
                    bindingRemote:InvokeServer("Training_2001", "Emit_2")
                end
                
                task.wait(0.05)
                
                -- Apply Boost Effect
                local boostRemote = trainEquipRemote:FindFirstChild("ApplyBindingTrainingBoostEffect")
                if boostRemote then
                    boostRemote:InvokeServer()
                end
                
                Stats.Trains = Stats.Trains + 1
                UpdateDisplay()
            end)
        end
    end
end)

-- Stats update
task.spawn(function()
    while task.wait(1) do
        UpdateDisplay()
    end
end)

-- BUTTON EVENTS
MinBtn.MouseButton1Click:Connect(function()
    Frame.Visible = false
    MinFrame.Visible = true
end)

RestoreBtn.MouseButton1Click:Connect(function()
    Frame.Visible = true
    MinFrame.Visible = false
end)

CloseBtn.MouseButton1Click:Connect(function()
    Config.Enabled = false
    Config.AutoTrain = false
    ScreenGui:Destroy()
end)

MultInput.FocusLost:Connect(function()
    local val = tonumber(MultInput.Text)
    if val and val >= 1 and val <= 999999999 then
        Config.Multiplier = math.floor(val)
        MultInput.Text = tostring(Config.Multiplier)
        print("✅ Multiplier set to: " .. Fmt(Config.Multiplier))
    else
        MultInput.Text = tostring(Config.Multiplier)
    end
end)

ActivateBtn.MouseButton1Click:Connect(function()
    Config.Enabled = not Config.Enabled
    
    if Config.Enabled then
        ActivateBtn.BackgroundColor3 = Color3.fromRGB(50, 255, 100)
        ActivateBtn.Text = "✅ ACTIVE"
        StatusLbl.Text = "🟢 Status: ACTIVE - Multiplying x" .. Fmt(Config.Multiplier)
        StatusLbl.TextColor3 = Color3.fromRGB(100, 255, 100)
        MinStatus.Text = "🟢 ON"
        MinStatus.TextColor3 = Color3.fromRGB(100, 255, 100)
        print("🔥 Hook ACTIVE - Multiplier: x" .. Fmt(Config.Multiplier))
    else
        ActivateBtn.BackgroundColor3 = Color3.fromRGB(50, 150, 255)
        ActivateBtn.Text = "🚀 ACTIVATE"
        StatusLbl.Text = "⚪ Status: OFF"
        StatusLbl.TextColor3 = Color3.fromRGB(200, 200, 200)
        MinStatus.Text = "⚪ OFF"
        MinStatus.TextColor3 = Color3.fromRGB(200, 200, 200)
        print("⚪ Hook DISABLED")
    end
end)

AutoBtn.MouseButton1Click:Connect(function()
    Config.AutoTrain = not Config.AutoTrain
    
    if Config.AutoTrain then
        AutoBtn.BackgroundColor3 = Color3.fromRGB(100, 200, 100)
        AutoBtn.Text = "🤖 AUTO TRAIN: ON"
        print("🤖 Auto Train ENABLED")
    else
        AutoBtn.BackgroundColor3 = Color3.fromRGB(60, 60, 80)
        AutoBtn.Text = "🤖 AUTO TRAIN: OFF"
        print("🤖 Auto Train DISABLED")
    end
end)

print("✅ Training Multiplier Loaded!")
print("📝 Set multiplier → ACTIVATE → AUTO TRAIN")
print("💡 Hook akan multiply nilai training yang diterima")
print("🔥 Default multiplier: 100,000x")
