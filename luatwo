-- TRAINING MULTIPLIER - Ultra Stable Version
-- Fokus pada peningkatan nilai training untuk Combat Power tinggi

local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- Configuration
local Config = {
    Enabled = false,
    AutoTrain = false,
    
    -- Multipliers untuk setiap stat
    ArmMultiplier = 1000000,      -- 1 Million default
    LegMultiplier = 1000000,      -- 1 Million default  
    BackMultiplier = 1000000,     -- 1 Million default
    AgilityMultiplier = 1000000,  -- 1 Million default
    
    GlobalMultiplier = 1,         -- Multiplier tambahan untuk semua
    
    TrainSpeed = 0.1,             -- Delay antar training (detik)
}

local Stats = {
    TotalGains = 0,
    TrainCount = 0,
    SessionTime = 0
}

-- Cache untuk remotes
local Remotes = {
    ApplyStationaryTrain = nil,
    ApplyMobileTrain = nil,
    ApplyBindingTrainingEffect = nil,
    ApplyBindingTrainingBoostEffect = nil,
    TrainSpeedHasChanged = nil
}

-- GUI Setup
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "TrainingMultiplier"
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.Parent = playerGui

-- Main Frame
local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 420, 0, 580)
MainFrame.Position = UDim2.new(0.5, -210, 0.5, -290)
MainFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 25)
MainFrame.BorderSizePixel = 0
MainFrame.Active = true
MainFrame.Draggable = true
MainFrame.Parent = ScreenGui

local MainCorner = Instance.new("UICorner")
MainCorner.CornerRadius = UDim.new(0, 12)
MainCorner.Parent = MainFrame

local MainStroke = Instance.new("UIStroke")
MainStroke.Color = Color3.fromRGB(100, 200, 255)
MainStroke.Thickness = 2
MainStroke.Parent = MainFrame

-- Header
local Header = Instance.new("Frame")
Header.Size = UDim2.new(1, 0, 0, 50)
Header.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
Header.BorderSizePixel = 0
Header.Parent = MainFrame

local HeaderCorner = Instance.new("UICorner")
HeaderCorner.CornerRadius = UDim.new(0, 12)
HeaderCorner.Parent = Header

local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, -100, 1, 0)
Title.Position = UDim2.new(0, 15, 0, 0)
Title.BackgroundTransparency = 1
Title.Text = "⚡ TRAINING MULTIPLIER"
Title.TextColor3 = Color3.fromRGB(100, 200, 255)
Title.TextSize = 20
Title.Font = Enum.Font.GothamBold
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.Parent = Header

-- Minimize Button
local MinBtn = Instance.new("TextButton")
MinBtn.Size = UDim2.new(0, 35, 0, 35)
MinBtn.Position = UDim2.new(1, -80, 0, 7)
MinBtn.BackgroundColor3 = Color3.fromRGB(50, 120, 200)
MinBtn.Text = "−"
MinBtn.TextSize = 24
MinBtn.Font = Enum.Font.GothamBold
MinBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
MinBtn.Parent = Header

local MinCorner = Instance.new("UICorner")
MinCorner.CornerRadius = UDim.new(0, 8)
MinCorner.Parent = MinBtn

-- Close Button
local CloseBtn = Instance.new("TextButton")
CloseBtn.Size = UDim2.new(0, 35, 0, 35)
CloseBtn.Position = UDim2.new(1, -40, 0, 7)
CloseBtn.BackgroundColor3 = Color3.fromRGB(220, 50, 50)
CloseBtn.Text = "✕"
CloseBtn.TextSize = 20
CloseBtn.Font = Enum.Font.GothamBold
CloseBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseBtn.Parent = Header

local CloseCorner = Instance.new("UICorner")
CloseCorner.CornerRadius = UDim.new(0, 8)
CloseCorner.Parent = CloseBtn

-- Content
local Content = Instance.new("ScrollingFrame")
Content.Size = UDim2.new(1, -20, 1, -60)
Content.Position = UDim2.new(0, 10, 0, 55)
Content.BackgroundTransparency = 1
Content.BorderSizePixel = 0
Content.ScrollBarThickness = 6
Content.CanvasSize = UDim2.new(0, 0, 0, 700)
Content.Parent = MainFrame

-- Stats Display
local StatsFrame = Instance.new("Frame")
StatsFrame.Size = UDim2.new(1, 0, 0, 100)
StatsFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
StatsFrame.BorderSizePixel = 0
StatsFrame.Parent = Content

local StatsCorner = Instance.new("UICorner")
StatsCorner.CornerRadius = UDim.new(0, 10)
StatsCorner.Parent = StatsFrame

local StatusLabel = Instance.new("TextLabel")
StatusLabel.Size = UDim2.new(1, -20, 0, 30)
StatusLabel.Position = UDim2.new(0, 10, 0, 10)
StatusLabel.BackgroundTransparency = 1
StatusLabel.Text = "⚪ Status: Standby"
StatusLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
StatusLabel.TextSize = 16
StatusLabel.Font = Enum.Font.GothamBold
StatusLabel.TextXAlignment = Enum.TextXAlignment.Left
StatusLabel.Parent = StatsFrame

local GainsLabel = Instance.new("TextLabel")
GainsLabel.Size = UDim2.new(1, -20, 0, 25)
GainsLabel.Position = UDim2.new(0, 10, 0, 45)
GainsLabel.BackgroundTransparency = 1
GainsLabel.Text = "💎 Total Gains: 0"
GainsLabel.TextColor3 = Color3.fromRGB(255, 200, 100)
GainsLabel.TextSize = 14
GainsLabel.Font = Enum.Font.Gotham
GainsLabel.TextXAlignment = Enum.TextXAlignment.Left
GainsLabel.Parent = StatsFrame

local CountLabel = Instance.new("TextLabel")
CountLabel.Size = UDim2.new(1, -20, 0, 25)
CountLabel.Position = UDim2.new(0, 10, 0, 72)
CountLabel.BackgroundTransparency = 1
CountLabel.Text = "🎯 Trains: 0"
CountLabel.TextColor3 = Color3.fromRGB(150, 255, 150)
CountLabel.TextSize = 14
CountLabel.Font = Enum.Font.Gotham
CountLabel.TextXAlignment = Enum.TextXAlignment.Left
CountLabel.Parent = StatsFrame

-- Function to create multiplier input
local function CreateMultiplierInput(name, yPos, defaultValue, emoji)
    local panel = Instance.new("Frame")
    panel.Size = UDim2.new(1, 0, 0, 80)
    panel.Position = UDim2.new(0, 0, 0, yPos)
    panel.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
    panel.BorderSizePixel = 0
    panel.Parent = Content
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 10)
    corner.Parent = panel
    
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, -20, 0, 30)
    label.Position = UDim2.new(0, 10, 0, 8)
    label.BackgroundTransparency = 1
    label.Text = emoji .. " " .. name
    label.TextColor3 = Color3.fromRGB(150, 200, 255)
    label.TextSize = 16
    label.Font = Enum.Font.GothamBold
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = panel
    
    local input = Instance.new("TextBox")
    input.Size = UDim2.new(1, -20, 0, 35)
    input.Position = UDim2.new(0, 10, 0, 40)
    input.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
    input.BorderSizePixel = 0
    input.Text = tostring(defaultValue)
    input.PlaceholderText = "Enter multiplier..."
    input.TextColor3 = Color3.fromRGB(255, 255, 255)
    input.TextSize = 16
    input.Font = Enum.Font.Gotham
    input.Parent = panel
    
    local inputCorner = Instance.new("UICorner")
    inputCorner.CornerRadius = UDim.new(0, 8)
    inputCorner.Parent = input
    
    return input
end

-- Create multiplier inputs
local ArmInput = CreateMultiplierInput("Arm Multiplier", 110, Config.ArmMultiplier, "💪")
local LegInput = CreateMultiplierInput("Leg Multiplier", 200, Config.LegMultiplier, "🦵")
local BackInput = CreateMultiplierInput("Back Multiplier", 290, Config.BackMultiplier, "🔥")
local AgilityInput = CreateMultiplierInput("Agility Multiplier", 380, Config.AgilityMultiplier, "⚡")
local GlobalInput = CreateMultiplierInput("Global Multiplier", 470, Config.GlobalMultiplier, "🌟")

-- Control Buttons
local ActivateBtn = Instance.new("TextButton")
ActivateBtn.Size = UDim2.new(1, 0, 0, 50)
ActivateBtn.Position = UDim2.new(0, 0, 0, 560)
ActivateBtn.BackgroundColor3 = Color3.fromRGB(50, 150, 50)
ActivateBtn.Text = "🚀 ACTIVATE"
ActivateBtn.TextSize = 18
ActivateBtn.Font = Enum.Font.GothamBold
ActivateBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
ActivateBtn.Parent = Content

local ActivateCorner = Instance.new("UICorner")
ActivateCorner.CornerRadius = UDim.new(0, 10)
ActivateCorner.Parent = ActivateBtn

local AutoBtn = Instance.new("TextButton")
AutoBtn.Size = UDim2.new(1, 0, 0, 45)
AutoBtn.Position = UDim2.new(0, 0, 0, 620)
AutoBtn.BackgroundColor3 = Color3.fromRGB(60, 60, 80)
AutoBtn.Text = "🤖 AUTO TRAIN: OFF"
AutoBtn.TextSize = 16
AutoBtn.Font = Enum.Font.GothamBold
AutoBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
AutoBtn.Parent = Content

local AutoCorner = Instance.new("UICorner")
AutoCorner.CornerRadius = UDim.new(0, 10)
AutoCorner.Parent = AutoBtn

-- Minimized Frame
local MinFrame = Instance.new("Frame")
MinFrame.Size = UDim2.new(0, 280, 0, 50)
MinFrame.Position = UDim2.new(0.5, -140, 0, 20)
MinFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 25)
MinFrame.BorderSizePixel = 0
MinFrame.Visible = false
MinFrame.Active = true
MinFrame.Draggable = true
MinFrame.Parent = ScreenGui

local MinFrameCorner = Instance.new("UICorner")
MinFrameCorner.CornerRadius = UDim.new(0, 10)
MinFrameCorner.Parent = MinFrame

local MinFrameStroke = Instance.new("UIStroke")
MinFrameStroke.Color = Color3.fromRGB(100, 200, 255)
MinFrameStroke.Thickness = 2
MinFrameStroke.Parent = MinFrame

local MinLabel = Instance.new("TextLabel")
MinLabel.Size = UDim2.new(1, -100, 1, 0)
MinLabel.Position = UDim2.new(0, 15, 0, 0)
MinLabel.BackgroundTransparency = 1
MinLabel.Text = "⚡ Training"
MinLabel.TextColor3 = Color3.fromRGB(100, 200, 255)
MinLabel.TextSize = 16
MinLabel.Font = Enum.Font.GothamBold
MinLabel.TextXAlignment = Enum.TextXAlignment.Left
MinLabel.Parent = MinFrame

local MinStatus = Instance.new("TextLabel")
MinStatus.Size = UDim2.new(0, 80, 1, 0)
MinStatus.Position = UDim2.new(1, -150, 0, 0)
MinStatus.BackgroundTransparency = 1
MinStatus.Text = "⚪ OFF"
MinStatus.TextColor3 = Color3.fromRGB(200, 200, 200)
MinStatus.TextSize = 14
MinStatus.Font = Enum.Font.GothamBold
MinStatus.Parent = MinFrame

local RestoreBtn = Instance.new("TextButton")
RestoreBtn.Size = UDim2.new(0, 40, 0, 40)
RestoreBtn.Position = UDim2.new(1, -45, 0, 5)
RestoreBtn.BackgroundColor3 = Color3.fromRGB(50, 120, 200)
RestoreBtn.Text = "□"
RestoreBtn.TextSize = 20
RestoreBtn.Font = Enum.Font.GothamBold
RestoreBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
RestoreBtn.Parent = MinFrame

local RestoreCorner = Instance.new("UICorner")
RestoreCorner.CornerRadius = UDim.new(0, 8)
RestoreCorner.Parent = RestoreBtn

-- Helper Functions
local function FormatNumber(num)
    if num >= 1e18 then return string.format("%.2fQu", num / 1e18)
    elseif num >= 1e15 then return string.format("%.2fQd", num / 1e15)
    elseif num >= 1e12 then return string.format("%.2fT", num / 1e12)
    elseif num >= 1e9 then return string.format("%.2fB", num / 1e9)
    elseif num >= 1e6 then return string.format("%.2fM", num / 1e6)
    elseif num >= 1e3 then return string.format("%.2fK", num / 1e3)
    else return tostring(math.floor(num)) end
end

local function UpdateStats()
    GainsLabel.Text = "💎 Total Gains: " .. FormatNumber(Stats.TotalGains)
    CountLabel.Text = "🎯 Trains: " .. FormatNumber(Stats.TrainCount)
end

local function UpdateInputs()
    local arm = tonumber(ArmInput.Text)
    local leg = tonumber(LegInput.Text)
    local back = tonumber(BackInput.Text)
    local agility = tonumber(AgilityInput.Text)
    local global = tonumber(GlobalInput.Text)
    
    if arm and arm >= 1 then Config.ArmMultiplier = math.floor(arm) end
    if leg and leg >= 1 then Config.LegMultiplier = math.floor(leg) end
    if back and back >= 1 then Config.BackMultiplier = math.floor(back) end
    if agility and agility >= 1 then Config.AgilityMultiplier = math.floor(agility) end
    if global and global >= 1 then Config.GlobalMultiplier = math.floor(global) end
end

-- Cache remotes
task.spawn(function()
    local success, err = pcall(function()
        local trainEquip = ReplicatedStorage:WaitForChild("TrainEquipment", 5)
        if trainEquip then
            local remote = trainEquip:FindFirstChild("Remote")
            if remote then
                Remotes.ApplyStationaryTrain = remote:FindFirstChild("ApplyStationaryTrain")
                Remotes.ApplyMobileTrain = remote:FindFirstChild("ApplyMobileTrain")
                Remotes.ApplyBindingTrainingEffect = remote:FindFirstChild("ApplyBindingTrainingEffect")
                Remotes.ApplyBindingTrainingBoostEffect = remote:FindFirstChild("ApplyBindingTrainingBoostEffect")
            end
        end
        
        local trainSystem = ReplicatedStorage:WaitForChild("TrainSystem", 5)
        if trainSystem then
            local remote = trainSystem:FindFirstChild("Remote")
            if remote then
                Remotes.TrainSpeedHasChanged = remote:FindFirstChild("TrainSpeedHasChanged")
            end
        end
    end)
    
    if success then
        print("✅ Remotes cached successfully")
    else
        warn("⚠️ Failed to cache remotes:", err)
    end
end)

-- Hook System untuk multiply returns
local oldNamecall
oldNamecall = hookmetamethod(game, "__namecall", function(self, ...)
    local method = getnamecallmethod()
    local args = {...}
    
    if not Config.Enabled then
        return oldNamecall(self, ...)
    end
    
    if method == "InvokeServer" or method == "Invoke" then
        local results = {pcall(oldNamecall, self, ...)}
        local success = table.remove(results, 1)
        
        if success and Config.Enabled then
            -- Multiply semua numeric returns
            for i, result in ipairs(results) do
                if type(result) == "number" and result > 0 and result < 1e15 then
                    local multiplier = Config.GlobalMultiplier
                    
                    -- Tentukan multiplier berdasarkan nama remote
                    if self.Name:find("Arm") or tostring(self):find("arm") then
                        multiplier = multiplier * Config.ArmMultiplier
                    elseif self.Name:find("Leg") or tostring(self):find("leg") then
                        multiplier = multiplier * Config.LegMultiplier
                    elseif self.Name:find("Back") or tostring(self):find("back") then
                        multiplier = multiplier * Config.BackMultiplier
                    elseif self.Name:find("Agility") or tostring(self):find("agility") then
                        multiplier = multiplier * Config.AgilityMultiplier
                    end
                    
                    local newValue = result * multiplier
                    Stats.TotalGains = Stats.TotalGains + (newValue - result)
                    results[i] = newValue
                end
            end
        end
        
        if success then
            return unpack(results)
        end
    end
    
    return oldNamecall(self, ...)
end)

-- Auto Training Loop
task.spawn(function()
    while task.wait(Config.TrainSpeed) do
        if Config.Enabled and Config.AutoTrain then
            pcall(function()
                if Remotes.ApplyStationaryTrain then
                    Remotes.ApplyStationaryTrain:InvokeServer()
                end
                
                if Remotes.ApplyMobileTrain then
                    Remotes.ApplyMobileTrain:InvokeServer()
                end
                
                if Remotes.ApplyBindingTrainingEffect then
                    Remotes.ApplyBindingTrainingEffect:InvokeServer("Training_2001", "Emit_2")
                end
                
                if Remotes.ApplyBindingTrainingBoostEffect then
                    Remotes.ApplyBindingTrainingBoostEffect:InvokeServer()
                end
                
                Stats.TrainCount = Stats.TrainCount + 1
            end)
        end
    end
end)

-- Stats Update Loop
task.spawn(function()
    while task.wait(0.5) do
        if Config.Enabled then
            UpdateStats()
            Stats.SessionTime = Stats.SessionTime + 0.5
        end
    end
end)

-- Button Events
MinBtn.MouseButton1Click:Connect(function()
    MainFrame.Visible = false
    MinFrame.Visible = true
end)

RestoreBtn.MouseButton1Click:Connect(function()
    MainFrame.Visible = true
    MinFrame.Visible = false
end)

CloseBtn.MouseButton1Click:Connect(function()
    Config.Enabled = false
    Config.AutoTrain = false
    ScreenGui:Destroy()
end)

ActivateBtn.MouseButton1Click:Connect(function()
    UpdateInputs()
    Config.Enabled = not Config.Enabled
    
    if Config.Enabled then
        ActivateBtn.BackgroundColor3 = Color3.fromRGB(100, 200, 100)
        ActivateBtn.Text = "✅ ACTIVE"
        StatusLabel.Text = "🟢 Status: Active"
        StatusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
        MinStatus.Text = "🟢 ON"
        MinStatus.TextColor3 = Color3.fromRGB(100, 255, 100)
    else
        ActivateBtn.BackgroundColor3 = Color3.fromRGB(50, 150, 50)
        ActivateBtn.Text = "🚀 ACTIVATE"
        StatusLabel.Text = "⚪ Status: Standby"
        StatusLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
        MinStatus.Text = "⚪ OFF"
        MinStatus.TextColor3 = Color3.fromRGB(200, 200, 200)
    end
end)

AutoBtn.MouseButton1Click:Connect(function()
    Config.AutoTrain = not Config.AutoTrain
    
    if Config.AutoTrain then
        AutoBtn.BackgroundColor3 = Color3.fromRGB(100, 150, 255)
        AutoBtn.Text = "🤖 AUTO TRAIN: ON"
    else
        AutoBtn.BackgroundColor3 = Color3.fromRGB(60, 60, 80)
        AutoBtn.Text = "🤖 AUTO TRAIN: OFF"
    end
end)

-- Input validation
for _, input in pairs({ArmInput, LegInput, BackInput, AgilityInput, GlobalInput}) do
    input.FocusLost:Connect(function()
        UpdateInputs()
    end)
end

print("✅ Training Multiplier loaded!")
print("💡 Set multipliers dan klik ACTIVATE")
print("🎯 Default: 1,000,000x untuk setiap stat")
print("🚀 Combat Power akan meningkat drastis!")
