-- Extreme Combat Power Auto Trainer V2 for Delta
-- Fixed version dengan remote events yang benar

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer

-- UI Library Setup
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "ExtremeCombatTrainerV2"
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")

-- Main Frame
local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 420, 0, 500)
MainFrame.Position = UDim2.new(0.5, -210, 0.5, -250)
MainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
MainFrame.BorderSizePixel = 0
MainFrame.Active = true
MainFrame.Draggable = true
MainFrame.Parent = ScreenGui

local MainCorner = Instance.new("UICorner")
MainCorner.CornerRadius = UDim.new(0, 10)
MainCorner.Parent = MainFrame

-- Title Bar
local TitleBar = Instance.new("Frame")
TitleBar.Name = "TitleBar"
TitleBar.Size = UDim2.new(1, 0, 0, 35)
TitleBar.BackgroundColor3 = Color3.fromRGB(35, 35, 50)
TitleBar.BorderSizePixel = 0
TitleBar.Parent = MainFrame

local TitleCorner = Instance.new("UICorner")
TitleCorner.CornerRadius = UDim.new(0, 10)
TitleCorner.Parent = TitleBar

local TitleLabel = Instance.new("TextLabel")
TitleLabel.Size = UDim2.new(1, -80, 1, 0)
TitleLabel.Position = UDim2.new(0, 10, 0, 0)
TitleLabel.BackgroundTransparency = 1
TitleLabel.Text = "âš¡ EXTREME COMBAT TRAINER V2"
TitleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
TitleLabel.TextSize = 15
TitleLabel.Font = Enum.Font.GothamBold
TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
TitleLabel.Parent = TitleBar

-- Minimize Button
local MinimizeButton = Instance.new("TextButton")
MinimizeButton.Size = UDim2.new(0, 30, 0, 30)
MinimizeButton.Position = UDim2.new(1, -65, 0, 2.5)
MinimizeButton.BackgroundColor3 = Color3.fromRGB(255, 200, 0)
MinimizeButton.Text = "_"
MinimizeButton.TextColor3 = Color3.fromRGB(0, 0, 0)
MinimizeButton.TextSize = 18
MinimizeButton.Font = Enum.Font.GothamBold
MinimizeButton.Parent = TitleBar

local MinCorner = Instance.new("UICorner")
MinCorner.CornerRadius = UDim.new(0, 6)
MinCorner.Parent = MinimizeButton

-- Close Button
local CloseButton = Instance.new("TextButton")
CloseButton.Size = UDim2.new(0, 30, 0, 30)
CloseButton.Position = UDim2.new(1, -32, 0, 2.5)
CloseButton.BackgroundColor3 = Color3.fromRGB(255, 60, 60)
CloseButton.Text = "X"
CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseButton.TextSize = 16
CloseButton.Font = Enum.Font.GothamBold
CloseButton.Parent = TitleBar

local CloseCorner = Instance.new("UICorner")
CloseCorner.CornerRadius = UDim.new(0, 6)
CloseCorner.Parent = CloseButton

-- Content Frame
local ContentFrame = Instance.new("Frame")
ContentFrame.Size = UDim2.new(1, -20, 1, -45)
ContentFrame.Position = UDim2.new(0, 10, 0, 40)
ContentFrame.BackgroundTransparency = 1
ContentFrame.Parent = MainFrame

-- Config Variables
local Config = {
    AutoTrain = false,
    TrainSpeed = 0.05,
    Multiplier = 1000000,
    UseBuffItems = true,
    Elements = {
        Arms = {enabled = true, itemId = 18},
        Legs = {enabled = true, itemId = 20},
        Back = {enabled = true, itemId = 19},
        Agility = {enabled = true, itemId = 21}
    }
}

-- Stats Display
local StatsFrame = Instance.new("Frame")
StatsFrame.Size = UDim2.new(1, 0, 0, 80)
StatsFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 50)
StatsFrame.BorderSizePixel = 0
StatsFrame.Parent = ContentFrame

local StatsCorner = Instance.new("UICorner")
StatsCorner.CornerRadius = UDim.new(0, 8)
StatsCorner.Parent = StatsFrame

local CombatPowerLabel = Instance.new("TextLabel")
CombatPowerLabel.Size = UDim2.new(1, -20, 0, 25)
CombatPowerLabel.Position = UDim2.new(0, 10, 0, 10)
CombatPowerLabel.BackgroundTransparency = 1
CombatPowerLabel.Text = "ðŸ’ª Combat Power: 0"
CombatPowerLabel.TextColor3 = Color3.fromRGB(0, 255, 150)
CombatPowerLabel.TextSize = 18
CombatPowerLabel.Font = Enum.Font.GothamBold
CombatPowerLabel.TextXAlignment = Enum.TextXAlignment.Left
CombatPowerLabel.Parent = StatsFrame

local MultiplierLabel = Instance.new("TextLabel")
MultiplierLabel.Size = UDim2.new(1, -20, 0, 20)
MultiplierLabel.Position = UDim2.new(0, 10, 0, 40)
MultiplierLabel.BackgroundTransparency = 1
MultiplierLabel.Text = "ðŸš€ Multiplier: x1,000,000"
MultiplierLabel.TextColor3 = Color3.fromRGB(255, 200, 0)
MultiplierLabel.TextSize = 14
MultiplierLabel.Font = Enum.Font.Gotham
MultiplierLabel.TextXAlignment = Enum.TextXAlignment.Left
MultiplierLabel.Parent = StatsFrame

-- Auto Train Toggle
local function CreateToggle(name, yPos, defaultState)
    local ToggleFrame = Instance.new("Frame")
    ToggleFrame.Size = UDim2.new(1, 0, 0, 40)
    ToggleFrame.Position = UDim2.new(0, 0, 0, yPos)
    ToggleFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 50)
    ToggleFrame.BorderSizePixel = 0
    ToggleFrame.Parent = ContentFrame
    
    local ToggleCorner = Instance.new("UICorner")
    ToggleCorner.CornerRadius = UDim.new(0, 8)
    ToggleCorner.Parent = ToggleFrame
    
    local ToggleLabel = Instance.new("TextLabel")
    ToggleLabel.Size = UDim2.new(0.7, 0, 1, 0)
    ToggleLabel.Position = UDim2.new(0, 10, 0, 0)
    ToggleLabel.BackgroundTransparency = 1
    ToggleLabel.Text = name
    ToggleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    ToggleLabel.TextSize = 14
    ToggleLabel.Font = Enum.Font.Gotham
    ToggleLabel.TextXAlignment = Enum.TextXAlignment.Left
    ToggleLabel.Parent = ToggleFrame
    
    local ToggleButton = Instance.new("TextButton")
    ToggleButton.Size = UDim2.new(0, 60, 0, 28)
    ToggleButton.Position = UDim2.new(1, -70, 0.5, -14)
    ToggleButton.BackgroundColor3 = defaultState and Color3.fromRGB(0, 200, 100) or Color3.fromRGB(100, 100, 100)
    ToggleButton.Text = defaultState and "ON" or "OFF"
    ToggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    ToggleButton.TextSize = 12
    ToggleButton.Font = Enum.Font.GothamBold
    ToggleButton.Parent = ToggleFrame
    
    local ToggleBtnCorner = Instance.new("UICorner")
    ToggleBtnCorner.CornerRadius = UDim.new(0, 6)
    ToggleBtnCorner.Parent = ToggleButton
    
    return ToggleButton
end

local AutoTrainToggle = CreateToggle("ðŸ”„ Auto Train (Extreme Speed)", 90, false)
local UseBuffToggle = CreateToggle("ðŸ’Š Auto Use Buff Items", 140, true)

-- Multiplier Slider
local SliderFrame = Instance.new("Frame")
SliderFrame.Size = UDim2.new(1, 0, 0, 60)
SliderFrame.Position = UDim2.new(0, 0, 0, 190)
SliderFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 50)
SliderFrame.BorderSizePixel = 0
SliderFrame.Parent = ContentFrame

local SliderCorner = Instance.new("UICorner")
SliderCorner.CornerRadius = UDim.new(0, 8)
SliderCorner.Parent = SliderFrame

local SliderLabel = Instance.new("TextLabel")
SliderLabel.Size = UDim2.new(1, -20, 0, 20)
SliderLabel.Position = UDim2.new(0, 10, 0, 5)
SliderLabel.BackgroundTransparency = 1
SliderLabel.Text = "âš¡ Power Multiplier"
SliderLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
SliderLabel.TextSize = 13
SliderLabel.Font = Enum.Font.GothamBold
SliderLabel.TextXAlignment = Enum.TextXAlignment.Left
SliderLabel.Parent = SliderFrame

local MultiplierValues = {1000000, 10000000, 100000000, 1000000000, 10000000000, 100000000000, 1000000000000}
local MultiplierNames = {"1M", "10M", "100M", "1B", "10B", "100B", "1T"}
local currentMultIndex = 1

local MultiplierButton = Instance.new("TextButton")
MultiplierButton.Size = UDim2.new(1, -20, 0, 28)
MultiplierButton.Position = UDim2.new(0, 10, 0, 27)
MultiplierButton.BackgroundColor3 = Color3.fromRGB(100, 50, 200)
MultiplierButton.Text = "x" .. MultiplierNames[currentMultIndex] .. " per train"
MultiplierButton.TextColor3 = Color3.fromRGB(255, 255, 255)
MultiplierButton.TextSize = 14
MultiplierButton.Font = Enum.Font.GothamBold
MultiplierButton.Parent = SliderFrame

local MultBtnCorner = Instance.new("UICorner")
MultBtnCorner.CornerRadius = UDim.new(0, 6)
MultBtnCorner.Parent = MultiplierButton

-- Element Selection
local ElementLabel = Instance.new("TextLabel")
ElementLabel.Size = UDim2.new(1, 0, 0, 25)
ElementLabel.Position = UDim2.new(0, 0, 0, 260)
ElementLabel.BackgroundTransparency = 1
ElementLabel.Text = "ðŸŽ¯ Train Elements (Item Buffs):"
ElementLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
ElementLabel.TextSize = 13
ElementLabel.Font = Enum.Font.GothamBold
ElementLabel.TextXAlignment = Enum.TextXAlignment.Left
ElementLabel.Parent = ContentFrame

local ElementButtons = {}
local elementData = {
    {name = "Arms ðŸ’ª (18)", key = "Arms"},
    {name = "Legs ðŸ¦µ (20)", key = "Legs"},
    {name = "Back ðŸ›¡ï¸ (19)", key = "Back"},
    {name = "Agility âš¡ (21)", key = "Agility"}
}

for i, data in ipairs(elementData) do
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(0.48, 0, 0, 35)
    btn.Position = UDim2.new((i-1)%2 * 0.52, 0, 0, 290 + math.floor((i-1)/2) * 45)
    btn.BackgroundColor3 = Color3.fromRGB(0, 150, 100)
    btn.Text = data.name
    btn.TextColor3 = Color3.fromRGB(255, 255, 255)
    btn.TextSize = 12
    btn.Font = Enum.Font.GothamBold
    btn.Parent = ContentFrame
    
    local btnCorner = Instance.new("UICorner")
    btnCorner.CornerRadius = UDim.new(0, 6)
    btnCorner.Parent = btn
    
    ElementButtons[data.key] = btn
end

-- Status Label
local StatusLabel = Instance.new("TextLabel")
StatusLabel.Size = UDim2.new(1, 0, 0, 30)
StatusLabel.Position = UDim2.new(0, 0, 1, -45)
StatusLabel.BackgroundTransparency = 1
StatusLabel.Text = "â¸ï¸ Status: Idle"
StatusLabel.TextColor3 = Color3.fromRGB(150, 150, 150)
StatusLabel.TextSize = 12
StatusLabel.Font = Enum.Font.Gotham
StatusLabel.TextXAlignment = Enum.TextXAlignment.Center
StatusLabel.Parent = ContentFrame

-- Button Handlers
AutoTrainToggle.MouseButton1Click:Connect(function()
    Config.AutoTrain = not Config.AutoTrain
    AutoTrainToggle.Text = Config.AutoTrain and "ON" or "OFF"
    AutoTrainToggle.BackgroundColor3 = Config.AutoTrain and Color3.fromRGB(0, 200, 100) or Color3.fromRGB(100, 100, 100)
    StatusLabel.Text = Config.AutoTrain and "ðŸŸ¢ Status: Training..." or "â¸ï¸ Status: Idle"
    StatusLabel.TextColor3 = Config.AutoTrain and Color3.fromRGB(0, 255, 150) or Color3.fromRGB(150, 150, 150)
end)

UseBuffToggle.MouseButton1Click:Connect(function()
    Config.UseBuffItems = not Config.UseBuffItems
    UseBuffToggle.Text = Config.UseBuffItems and "ON" or "OFF"
    UseBuffToggle.BackgroundColor3 = Config.UseBuffItems and Color3.fromRGB(0, 200, 100) or Color3.fromRGB(100, 100, 100)
end)

MultiplierButton.MouseButton1Click:Connect(function()
    currentMultIndex = currentMultIndex % #MultiplierValues + 1
    Config.Multiplier = MultiplierValues[currentMultIndex]
    MultiplierButton.Text = "x" .. MultiplierNames[currentMultIndex] .. " per train"
    MultiplierLabel.Text = "ðŸš€ Multiplier: x" .. MultiplierNames[currentMultIndex]
end)

for key, btn in pairs(ElementButtons) do
    btn.MouseButton1Click:Connect(function()
        Config.Elements[key].enabled = not Config.Elements[key].enabled
        btn.BackgroundColor3 = Config.Elements[key].enabled and Color3.fromRGB(0, 150, 100) or Color3.fromRGB(100, 50, 50)
    end)
end

MinimizeButton.MouseButton1Click:Connect(function()
    ContentFrame.Visible = not ContentFrame.Visible
    MainFrame.Size = ContentFrame.Visible and UDim2.new(0, 420, 0, 500) or UDim2.new(0, 420, 0, 35)
end)

CloseButton.MouseButton1Click:Connect(function()
    ScreenGui:Destroy()
end)

-- Helper Functions
local function FormatNumber(num)
    if num >= 1e12 then
        return string.format("%.2fT", num / 1e12)
    elseif num >= 1e9 then
        return string.format("%.2fB", num / 1e9)
    elseif num >= 1e6 then
        return string.format("%.2fM", num / 1e6)
    elseif num >= 1e3 then
        return string.format("%.2fK", num / 1e3)
    else
        return tostring(math.floor(num))
    end
end

-- Use Buff Item Function
local function UseBuffItem(itemId)
    pcall(function()
        local TryOperatingItemByPlayer = ReplicatedStorage:FindFirstChild("PlayerItemBackpack")
            and ReplicatedStorage.PlayerItemBackpack:FindFirstChild("Remote")
            and ReplicatedStorage.PlayerItemBackpack.Remote:FindFirstChild("TryOperatingItemByPlayer")
        
        if TryOperatingItemByPlayer then
            TryOperatingItemByPlayer:InvokeServer(
                {
                    GridInfo = {Id = itemId, Num = 1},
                    GridIndex = "401"
                },
                itemId,
                1,
                {Operation = "UseItem", PointingOperation = "UseSingleBuffConsum"}
            )
        end
    end)
end

-- Training Functions
local function GetCurrentTrainValue(trainType)
    local success, value = pcall(function()
        local GetTrainValue = ReplicatedStorage:FindFirstChild("TrainSystem")
            and ReplicatedStorage.TrainSystem:FindFirstChild("Bindable")
            and ReplicatedStorage.TrainSystem.Bindable:FindFirstChild("GetTrainValue")
        
        if GetTrainValue then
            return GetTrainValue:Invoke(LocalPlayer, trainType)
        end
        return 0
    end)
    return success and value or 0
end

local function SetTrainValue(trainType, newValue, oldValue)
    pcall(function()
        -- Fire ke BindableEvent dulu
        local PlayerTrainValueHasChanged = ReplicatedStorage:FindFirstChild("TrainSystem")
            and ReplicatedStorage.TrainSystem:FindFirstChild("Bindable")
            and ReplicatedStorage.TrainSystem.Bindable:FindFirstChild("PlayerTrainValueHasChanged")
        
        if PlayerTrainValueHasChanged then
            PlayerTrainValueHasChanged:Fire(LocalPlayer, trainType, newValue, oldValue)
        end
    end)
end

local function FireTrainingSpeed(elementType)
    pcall(function()
        local TrainSpeedHasChanged = ReplicatedStorage:FindFirstChild("TrainSystem")
            and ReplicatedStorage.TrainSystem:FindFirstChild("Remote")
            and ReplicatedStorage.TrainSystem.Remote:FindFirstChild("TrainSpeedHasChanged")
        
        if TrainSpeedHasChanged then
            TrainSpeedHasChanged:FireServer(elementType)
        end
    end)
end

local function ApplyTrainingMethods()
    pcall(function()
        -- Apply Mobile Train
        local ApplyMobileTrain = ReplicatedStorage:FindFirstChild("TrainEquipment")
            and ReplicatedStorage.TrainEquipment:FindFirstChild("Remote")
            and ReplicatedStorage.TrainEquipment.Remote:FindFirstChild("ApplyMobileTrain")
        
        if ApplyMobileTrain then
            ApplyMobileTrain:InvokeServer()
        end
        
        -- Apply Stationary Train
        local ApplyStationaryTrain = ReplicatedStorage:FindFirstChild("TrainEquipment")
            and ReplicatedStorage.TrainEquipment:FindFirstChild("Remote")
            and ReplicatedStorage.TrainEquipment.Remote:FindFirstChild("ApplyStationaryTrain")
        
        if ApplyStationaryTrain then
            ApplyStationaryTrain:InvokeServer()
        end
    end)
end

-- Main Training Loop
local lastBuffTime = {}
local trainingActive = false

spawn(function()
    while wait(Config.TrainSpeed) do
        if Config.AutoTrain and not trainingActive then
            trainingActive = true
            
            -- Train each enabled element
            for key, element in pairs(Config.Elements) do
                if element.enabled then
                    local elementType = key == "Arms" and 1 or key == "Legs" and 2 or key == "Back" and 3 or 4
                    
                    -- Use buff item if enabled (setiap 15 detik per element)
                    if Config.UseBuffItems then
                        if not lastBuffTime[key] or (tick() - lastBuffTime[key]) > 15 then
                            UseBuffItem(element.itemId)
                            lastBuffTime[key] = tick()
                        end
                    end
                    
                    -- Get current value
                    local currentValue = GetCurrentTrainValue(elementType)
                    
                    -- Calculate new value dengan multiplier
                    local baseIncrease = 18 -- Base training value
                    local increase = baseIncrease * Config.Multiplier
                    local newValue = currentValue + increase
                    
                    -- Set new training value
                    SetTrainValue(elementType, newValue, currentValue)
                    
                    -- Fire training speed
                    FireTrainingSpeed(elementType)
                    
                    wait(0.02)
                end
            end
            
            -- Apply training methods
            ApplyTrainingMethods()
            
            trainingActive = false
        end
    end
end)

-- Update Combat Power Display
spawn(function()
    while wait(0.5) do
        pcall(function()
            local GetCombatPower = ReplicatedStorage:FindFirstChild("TrainSystem")
                and ReplicatedStorage.TrainSystem:FindFirstChild("Bindable")
                and ReplicatedStorage.TrainSystem.Bindable:FindFirstChild("GetCombatPower")
            
            if GetCombatPower then
                local combatPower = GetCombatPower:Invoke(LocalPlayer)
                if combatPower then
                    CombatPowerLabel.Text = "ðŸ’ª Combat Power: " .. FormatNumber(combatPower)
                end
            end
        end)
    end
end)

print("âœ… Extreme Combat Trainer V2 Loaded!")
print("ðŸ“Œ Item Buffs:")
print("   - Arms: Item18")
print("   - Back: Item19")
print("   - Legs: Item20")
print("   - Agility: Item21")
print("âš¡ Multiplier: 1M - 1T per training!")
print("ðŸŽ¯ Target: Ratusan juta - triliun+ Combat Power")
